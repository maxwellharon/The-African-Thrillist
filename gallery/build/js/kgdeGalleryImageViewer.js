'use strict';var KGDE=window.KGDE||{};KGDE.imageViewer={c:{classOverlay:'kgdeImageViewerOverlay',classList:'kgdeImageViewerWrapper',classImage:'kgdeImageViewer',classButtonBack:'kgdeImageViewerGoBack',classButtonNext:'kgdeImageViewerGoNext',classButtonClose:'kgdeImageViewerClose',classVisible:'kgdeImageViewerActive',classToolsVisible:'kgdeImageViewerShowTools',classAnim:'kgdeImageViewerAnim',classesFormat:{portrait:'kgdeImageViewerPortrait',landscape:'kgdeImageViewerLandscape'},overlay:null,imageWrapper:null,buttonBack:null,buttonNext:null,itemWidth:0,itemPositions:[],currentPosition:1,transitionRun:null,resizeRun:null,sources:[],index:0,isInitialized:!1,isToolsVisible:!1,slide:{moveLeft:0,initialLeft:0,startX:0,startY:0,distX:0,distY:0,currX:0,currY:0,startTime:0,dragging:!1,animate:!1}},init:function b(){this.overlay=document.createElement('div'),this.overlay.classList.add(this.c.classOverlay),this.list=document.createElement('div'),this.list.classList.add(this.c.classList);for(var c,d=0;3>d;d+=1)c=document.createElement('div'),c.classList.add(this.c.classImage),this.list.appendChild(c);var a=document.createTextNode('x');this.buttonClose=document.createElement('div'),this.buttonClose.classList.add(this.c.classButtonClose),this.buttonClose.appendChild(a),this.buttonBack=document.createElement('div'),this.buttonBack.classList.add(this.c.classButtonBack),this.buttonNext=document.createElement('div'),this.buttonNext.classList.add(this.c.classButtonNext),this.overlay.appendChild(this.list),this.overlay.appendChild(this.buttonClose),this.overlay.appendChild(this.buttonBack),this.overlay.appendChild(this.buttonNext),document.body.appendChild(this.overlay),this.addEvents()},addEvents:function a(){switch(KGDE.utils.getDeviceType()){case'TOUCH':this.list.addEventListener('touchstart',this,!1),this.list.addEventListener('touchmove',this,!1),this.list.addEventListener('touchend',this,!1);break;case'POINTER':this.list.addEventListener('pointerdown',this,!1),this.list.addEventListener('pointermove',this,!1),this.list.addEventListener('pointerup',this,!1),this.list.addEventListener('pointerleave',this,!1),this.list.addEventListener('dragstart',this,!1);break;default:this.list.addEventListener('mousedown',this,!1),this.list.addEventListener('mousemove',this,!1),this.list.addEventListener('mouseup',this,!1),this.list.addEventListener('dragstart',this,!1),document.addEventListener('mousemove',this,!1);}this.list.addEventListener('transitionend',this,!1),this.buttonClose.addEventListener('click',this,!1),this.buttonBack.addEventListener('click',this,!1),this.buttonNext.addEventListener('click',this,!1),window.addEventListener('resize',this,!1)},setSizes:function a(){this.c.itemWidth=this.list.offsetWidth,this.c.itemPositions=[-1*this.c.itemWidth,0,this.c.itemWidth]},openViewer:function b(a){// sizes available only if display not none
this.c.isInitialized||(this.init(),this.c.isInitialized=!0),this.c.sources=a.list,this.c.index=parseInt(a.index),this.c.sync=a.sync,this.showImage(),this.overlay.classList.add(this.c.classVisible),this.setSizes()},showImage:function b(){var a=this;// load next images with delay
this.addImageToWrapper(1,this.c.index),setTimeout(function(){a.loadNextImage()},1e3)},loadNextImage:function c(){for(var d=-1;2>d;d+=1)if(0!=d){var a=d+1,b=this.getImageIndex(d);this.addImageToWrapper(a,b)}},addImageToWrapper:function e(a,b){var c=this.list.getElementsByClassName(this.c.classImage)[a],d=document.createElement('img');d.src=this.c.sources[b],c.innerHTML='',c.appendChild(d),d.addEventListener('load',this,!1)},hideImage:function d(){this.overlay.classList.remove(this.c.classVisible);for(var a=this.list.getElementsByClassName(this.c.classImage),b=a.length,c=0;c<b;c+=1)a[c].innerHTML=''},checkImage:function d(a){var b=a.currentTarget,c=b.height>b.width?'portrait':'landscape';b.classList.add(this.c.classesFormat[c])},dragstart:function c(a){if(this.c.slide.animate)return!0;var b=a.touches?a.touches[0]:!!a.changedTouches&&a.changedTouches[0];// get touch x if available or mouse x
return this.c.slide.startX=b?b.pageX:a.clientX,this.c.slide.startY=b?b.pageY:a.clientY,this.c.slide.startTime=new Date().getTime(),this.c.slide.initalLeft=this.c.slide.moveLeft,this.c.slide.dragging=!0,!1},drag:function c(a){if(!this.c.slide.dragging)return!0;if(a.currentTarget!==this.list)return this.dragend(a),!0;var b=a.touches?a.touches[0]:!!a.changedTouches&&a.changedTouches[0];// get touch x/y if available or mouse x/y
return this.c.slide.currX=b?b.pageX:a.clientX,this.c.slide.currY=b?b.pageY:a.clientY,this.c.slide.distX=this.c.slide.currX-this.c.slide.startX,this.c.slide.distY=this.c.slide.currY-this.c.slide.startY,a.preventDefault(),a.stopPropagation(),this.c.slide.moveLeft=this.c.slide.distX+this.c.slide.initalLeft,this.list.style.transform='translate('+this.c.slide.moveLeft+'px, 0)',!1},dragend:function d(){if(!this.c.slide.dragging)return!0;// get duration between down and up
var a=new Date().getTime()-this.c.slide.startTime;// detect click by short duration and missing move
if(300>a&&5>Math.abs(this.c.slide.distX)&&5>Math.abs(this.c.slide.distY))return this.toggleToolDisplay(),this.reset(),!0;var b=0>this.c.slide.distX?-1:1,c=Math.abs(this.c.slide.distX)>this.c.itemWidth/5;if(c){var e=this.c.currentPosition+b;this.c.currentPosition=-1<e&&e<this.c.itemPositions.length?e:this.c.currentPosition}return this.animDragend(),this.reset(),!0},animDragend:function b(){var a=this;this.c.slide.animate=!0,this.c.slide.moveLeft=this.c.itemPositions[this.c.currentPosition],this.list.classList.add(this.c.classAnim),this.list.style.transform='translate('+this.c.slide.moveLeft+'px, 0)',this.c.transitionRun=setTimeout(function(){a.c.slide.animate&&a.updateList()},500)},updateList:function f(){if(this.list.classList.contains(this.c.classAnim)&&this.list.classList.remove(this.c.classAnim),1===this.c.currentPosition)return this.c.slide.animate=!1,!0;var a=this.list.getElementsByClassName(this.c.classImage);this.list.removeChild(a[this.c.currentPosition]);var b=2===this.c.currentPosition?-1:1;this.c.index=this.getImageIndex(b);var c=this.getImageIndex(b),d=document.createElement('img');d.src=this.c.sources[c],d.addEventListener('load',this,!1);var e=document.createElement('div');return e.classList.add(this.c.classImage),e.appendChild(d),2===this.c.currentPosition?this.list.insertBefore(e,a[0]):this.list.appendChild(e),this.c.currentPosition=1,this.c.slide.moveLeft=0,this.list.style.transform='translate('+this.c.slide.moveLeft+'px, 0)',this.c.slide.animate=!1,!0},getImageIndex:function c(a){var b=0>this.c.index+a?this.c.sources.length-1:this.c.index+a>=this.c.sources.length?0:this.c.index+a;return b},handleClose:function a(){this.c.sync(this.c.index),this.hideImage()},goBack:function a(){this.c.currentPosition=0,this.animDragend()},goNext:function a(){this.c.currentPosition=2,this.animDragend()},toggleToolDisplay:function a(){this.c.isToolsVisible=!this.c.isToolsVisible,this.c.isToolsVisible?this.overlay.classList.add(this.c.classToolsVisible):this.overlay.classList.contains(this.c.classToolsVisible)&&this.overlay.classList.remove(this.c.classToolsVisible)},reset:function a(){this.c.slide.dragging=!1,this.c.slide.startX=!1,this.c.slide.startY=!1,this.c.slide.currX=0,this.c.slide.currY=0,this.c.slide.distX=0,this.c.slide.distY=0},avoidGhostDragging:function b(a){return a.preventDefault(),!1},clickHandler:function b(a){switch(a.stopPropagation(),a.preventDefault(),a.currentTarget){case this.buttonBack:this.goBack();break;case this.buttonNext:this.goNext();break;case this.buttonClose:this.handleClose();}return!0},resizeHandler:function b(){var a=this;clearTimeout(this.c.resizeRun),this.c.resizeRun=setTimeout(function(){a.setSizes()},200)},handleEvent:function b(a){// we do not need a rightclick
if(0<a.button||a.ctrlKey)return!0;// set touch flag to avoid double events on mobile devices
switch(a.type){case'click':return this.clickHandler(a);case'pointerdown':case'touchstart':return this.dragstart(a);case'pointermove':case'touchmove':return this.drag(a);case'pointerup':case'pointerleave':case'touchend':return this.dragend(a);case'mousedown':return this.dragstart(a);case'mousemove':return this.drag(a);case'mouseup':return this.dragend(a);case'dragstart':return this.avoidGhostDragging(a);case'transitionend':return this.updateList(a);case'resize':return this.resizeHandler(a);case'load':this.checkImage(a);case'dragstart':return a.preventDefault(),!1;}}};